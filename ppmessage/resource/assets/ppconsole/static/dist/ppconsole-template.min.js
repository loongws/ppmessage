function $yvPaginationService(){var e=function(e,t){for(var n,r=e.page_offset*e.page_size,s=r+e.page_size,a=r,o=[];void 0!==(n=t[a++])&&a<=s;)o.push(n);return o},t=function(e,t){function n(t,n){return t[e.sort_key]>n[e.sort_key]?-1:1}return e.sort?t.sort(n):t},n=function(e){if(""===e.filter_value)return e.members||[];var t=e.filter_value,n=new RegExp(".*"+t+".*","g"),r=[];return angular.forEach(e.members,function(t,s){for(var a=0;a<e.filter_keys.length;a++)if(n.test(t[e.filter_keys[a]])){r.push(t);break}}),r},r=function(r){var s=12,a=angular.extend({filter_value:"",page_size:s,page_offset:0,sort_key:"updatetime",sort:!0},r),o=n(a),_=o.length,i=e(a,t(a,o));return{total:_,page:i}};return{pagination:function(e){return r(e)}}}function $yvAjaxService(e,t,n,r,s,a,o,_,i){var u=function(e){var t="/ppauth/token",r=e,s={};return s.url=t,s.method="POST",s.data=r,s.headers={"Content-Type":"application/x-www-form-urlencoded"},_.d("AUTH POST url: %s, data: %o.",s.url,s.data),n(s)},c=function(e){var t="grant_type=password&user_email="+e.user_email+"&user_password="+e.user_password+"&client_id="+a.PPCONSOLE_API.key;return u(t)},l=function(){var e="grant_type=client_credentials&client_secret="+a.PPCONSOLE_API.secret+"&client_id="+a.PPCONSOLE_API.key;return u(e)},p=function(e,t,r){t=t||{};var s="/api"+e,a=r;return a=a.replace(/\"/g,""),n({headers:{"Content-Type":"application/json;charset=utf-8",Authorization:"OAuth "+a},method:"POST",cache:!1,url:s,data:t})},g=function(e,t){return p(e,t,r.get(a.COOKIE_KEY.ACCESS_TOKEN))},m={NO_ERR:0,NO_PARA:6,EX_USER:22};return{login:function(e){return c(e)},ppconsole_get_overview_number:function(e){return g("/PPCONSOLE_GET_OVERVIEW_NUMBER",{app_uuid:e})},ppconsole_get_real_time_customer_number:function(e){return g("/PPCONSOLE_GET_REAL_TIME_CUSTOMER_NUMBER",{app_uuid:e})},ppconsole_get_real_time_service_number:function(e){return g("/PPCONSOLE_GET_REAL_TIME_SERVICE_NUMBER",{app_uuid:e})},ppconsole_get_real_time_message_number:function(e){return g("/PPCONSOLE_GET_REAL_TIME_MESSAGE_NUMBER",{app_uuid:e})},ppconsole_get_service_number_by_range:function(e,t,n){return g("/PPCONSOLE_GET_SERVICE_NUMBER_BY_RANGE",{app_uuid:e,begin_date:t,end_date:n})},ppconsole_get_customer_number_by_range:function(e,t,n){return g("/PPCONSOLE_GET_CUSTOMER_NUMBER_BY_RANGE",{app_uuid:e,begin_date:t,end_date:n})},ppconsole_get_message_number_by_range:function(e,t,n){return g("/PPCONSOLE_GET_MESSAGE_NUMBER_BY_RANGE",{app_uuid:e,begin_date:t,end_date:n})},logout:function(e){return g("/PPCONSOLE_LOGOUT",{user_uuid:e})},get_user_detail:function(e){return g("/PP_GET_USER_DETAIL",{user_uuid:e})},get_user_detail_with_password:function(e){return g("/PP_GET_USER_DETAIL",{user_uuid:e,return_password:!0})},get_admin_detail:function(e){return g("/PP_GET_ADMIN_DETAIL",{user_uuid:e})},get_admin_detail_with_password:function(e){return g("/PP_GET_ADMIN_DETAIL",{user_uuid:e,return_password:!0})},create_app:function(e,t){return g("/PP_CREATE_APP",{user_uuid:e,app_name:t})},remove_app:function(e,t,n){return g("/PP_REMOVE_APP",{user_uuid:e,app_uuid:t,app_key:n})},leave_app:function(e,t){return g("/PP_LEAVE_APP",{user_list:e,app_uuid:t})},is_email_valid:function(e){return g("/PP_IS_EMAIL_VALID",e)},get_app_owned_by_user:function(e){return g("/PP_GET_APP_OWNED_BY_USER",{user_uuid:e})},update_app_info:function(e){return g("/PP_UPDATE_APP_INFO",e)},create_user:function(e){return g("/PP_CREATE_USER",e)},update_user:function(e){return g("/PP_UPDATE_USER",e)},remove_user:function(e){return g("/PP_REMOVE_USER",{user_uuid:e})},get_app_conversation_list:function(e){return g("/PP_GET_APP_CONVERSATION_LIST",e)},get_history_messages:function(e){return g("/PP_GET_HISTORY_MESSAGE",e)},create_org_group:function(e){return g("/PP_CREATE_ORG_GROUP",e)},get_app_org_group_list:function(e){return g("/PP_GET_APP_ORG_GROUP_LIST",e)},get_org_group_detail:function(e){return g("/PP_GET_ORG_GROUP_DETAIL",e)},get_org_group_user_list:function(e){return g("/PP_GET_ORG_GROUP_USER_LIST",e)},update_org_group:function(e){return g("/PP_UPDATE_ORG_GROUP",e)},remove_org_group:function(e){return g("/PP_REMOVE_ORG_GROUP",e)},add_org_group_user:function(e){return g("/PP_ADD_ORG_GROUP_USER",e)},remove_org_group_user:function(e){return g("/PP_REMOVE_ORG_GROUP_USER",e)},get_no_group_user_list:function(e){return g("/PP_GET_NO_GROUP_USER_LIST",e)},get_team_service_user_list:function(e){return g("/PP_GET_APP_SERVICE_USER_LIST",e)},get_api_info:function(e){return g("/PP_GET_API_INFO",e)},get_credentials_token:function(){return l()},signup:function(e,t){return p("/PPCONSOLE_SIGNUP",e,t)},send_new_password:function(e,t){return p("/PPCONSOLE_SEND_NEW_PASSWORD",e,t)},get_all_apps:function(e){return g("/PP_GET_ALL_APP_LIST",e)},auth:function(e){return c(e)},API_ERR:m}}function $yvUserService(){var e={uuid:null,app_uuid:null,session_uuid:null,email:null,fullname:null,icon:null,lang:null,role:null,logined:!1,password:null,status:null,firstname:null,lastname:null,company:null,team:null,access_token:null};return{get:function(t){return 0===arguments.length?e:e.hasOwnProperty(t)?e[t]:null},set:function(t,n){e.hasOwnProperty(t)&&(e[t]=n)},is_admin_user:function(){return e&&"ADMIN"===e.status},set_company:function(t){e.company=t},get_company:function(){return e.company},set_lastname:function(t){e.lastname=t},get_lastname:function(){return e.lastname},set_firstname:function(t){e.firstname=t},get_firstname:function(){return e.firstname},set_status:function(t){e.status=t},get_status:function(){return e.status},get_password:function(){return e.password},set_password:function(t){e.password=t},get_session:function(){return e.session_uuid},set_session:function(t){e.session_uuid=t},set_email:function(t){e.email=t},get_email:function(){return e.email},set_fullname:function(t){e.fullname=t},get_fullname:function(){return e.fullname},set_icon:function(t){e.icon=t},get_icon:function(){return e.icon},set_uuid:function(t){e.uuid=t},get_uuid:function(){return e.uuid},set_language:function(t){e.lang=t},get_language:function(){return e.lang},set_role:function(t){e.role=t},get_role:function(){return e.role},set_logined:function(t){e.logined=t},get_logined:function(){return e.logined},set_app_uuid:function(t){e.app_uuid=t},get_app_uuid:function(){return e.app_uuid},set_team:function(t){null==e.team&&(e.team={}),t||(e.team=t);for(var n in t)t.hasOwnProperty(n)&&(e.team[n]=t[n])},get_team:function(){return e.team},set_team_agent:function(t){e.team.agent_num=t},get_team_agent:function(){return e.team.agent_num},set_login_data:function(e){this.set_logined(!0),this.set_fullname(e.user_fullname),this.set_lastname(e.user_lastname),this.set_firstname(e.user_firstname),this.set_company(e.user_company),this.set_email(e.user_email),this.set_session(e.session_uuid),this.set_uuid(e.uuid),this.set_password(e.user_password),this.set_app_uuid(e.app_uuid),this.set_icon(e.user_icon),this.set_status(e.user_status)},logout:function(){for(var t in e)e[t]=null;e.logined=!1,console.log("===",this.get())}}}function $yvMime(){var e=function(e){var t="../img/",n=t+"document-word.png",r=t+"document-xls.png",s=t+"document-pdf.png",a=t+"document-ppt.png",o=t+"document-plain.png",_={"application/vnd.openxmlformats-officedocument.wordprocessingml.document":n,"application/msword":n,"application/vnd.ms-excel":r,"application/x-excel":r,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":r,"application/vnd.ms-powerpoint":a,"application/vnd.openxmlformats-officedocument.presentationml.presentation":a,"application/vnd.ms-powerpoint":a,"application/vnd.openxmlformats-officedocument.presentationml.slideshow":a,"application/pdf":s};return _.hasOwnProperty(e)?_[e]:o};return{mime_icon:function(t){return e(t)}}}function $yvUtilService(e,t,n,r,s,a){var o=function(e){return e.indexOf("ppmessage.cn")==-1},_=function(){return{getMessageSummary:function(e,t,n){if(!e||!t||!n)return"";var r=e;switch(t){case"TEXT":return n;case"FILE":return"["+r["statistics.historymessages.MESSAGE_FILE_TYPE_TAG"]+"] "+JSON.parse(n).name;case"IMAGE":return"["+r["statistics.historymessages.MESSAGE_IMAGE_TYPE_TAG"]+"]";case"TXT":return"["+r["statistics.historymessages.MESSAGE_TXT_TYPE_TAG"]+"]";default:return""}},getMessageFormatedDate:function(e){if(!e)return"";if(e.message_body&&"string"==typeof e.message_body){var t=JSON.parse(e.message_body);return moment.unix(t.ts).format("YYYY-MM-DD HH:mm")}return u.moment(e.updatetime).format("YYYY-MM-DD HH:mm")},getConversationUpdateTsInSeconds:function(e){if(!e)return 0;if(e.latest_message){var t=e.latest_message.message_body;if(t&&"string"==typeof t)return JSON.parse(t).ts}return u.moment(e.updatetime).unix()}}}(),i=function(){var e=s.DEFAULT_USER_ICON;return{getIcon:function(t){if(!t)return e;var n=/(^https?:\/\/)|(^w{3})/.test(t);return n?t:c.getFileDownloadUrl(t)}}}(),u=function(){return{moment:function(e){return moment(e,"YYYY-MM-DD HH:mm:ss SSS")}}}(),c=function(){return{getFileDownloadUrl:function(e,t){var n="/download/download/"+e;return t&&(n+="?file_name="+t),n},getRemoteTextFileContent:function(e,t,r){return n({method:"GET",cache:!1,url:e,cache:!1}).success(function(e){t&&t(e)}).error(function(e){r&&r(e)})}}}(),l=function(){var e=1,t=16,n={OK:0,MIN_LENGTH_LIMIT:1,MAX_LENGTH_LIMIT:2,CONTAIN_WHITESPACE_AT_HEAD_OR_TAIL:3,REPEAT_PASSWORD_MIS_MATCH:4};return{ERR_CODE:n,validatePassword:function(r){return!r||r.length<e?n.MIN_LENGTH_LIMIT:r.length>t?n.MAX_LENGTH_LIMIT:/(^\s+)|(\s+$)/g.test(r)?n.CONTAIN_WHITESPACE_AT_HEAD_OR_TAIL:n.OK},validateRepeatPassword:function(e,t){var r=this.validatePassword(e);return r!==n.OK?r:e!==t?n.REPEAT_PASSWORD_MIS_MATCH:n.OK}}}();return{translate:function(n,r,s,a){var o=function(){t(s).then(function(e){n[r]=e,a&&a()})},_=e.$on("$translateChangeSuccess",o);o(),n.$on("$destroy",function(){_()})},noti:function(e,t){var n="danger";t&&(n="success"),$.bootstrapGrowl(e,{ele:"body",type:n,offset:{from:"top",amount:20},align:"center",width:400,delay:4e3,allow_dismiss:!0,stackup_spacing:10})},uuid:function(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:7&n|8).toString(16)});return t},get_view_port:function(){var e=window,t="inner";return"innerWidth"in window||(t="client",e=document.documentElement||document.body),{width:e[t+"Width"],height:e[t+"Height"]}},is_valid_email:function(e){var t=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return t.test(e)},base64_decode:function(e){return r.decode(e)},base64_encode:function(e){return r.encode(e)},http_protocol:function(e){return o(e)?"http://":"https://"},ws_protocol:function(e){return o(e)?"ws://":"wss://"},regexp_check:function(e){var t=RegExp("[\\u4E00-\\u9FFF\\dA-z@-_\\s*]+","i");if(!e||!e.match(t))return!1;var n=e.match(t).toString().length;return n==e.length},formateTimestamp:function(e){var t=moment(e).format("YYYY-MM-DD HH:mm:ss");return t},messageUtil:_,iconUtil:i,dateUtil:u,fileUtil:c,validator:l,isNull:function(e){return void 0===e||null===e}}}function $yvLog(){function e(){var e="%c↓↓↓↓↓↓↓↓↓↓";return t(e,"font-size:28px; color:blue;"),this}function t(){if(r){var e=Array.prototype.slice.call(arguments);o?console.log.apply(console,e):console.log(e)}return this}function n(){if(s){var e=Array.prototype.slice.call(arguments);o?console.log.apply(console,e):console.log(e)}return this}var r=!0,s=!0,a=!("undefined"==typeof console||"undefined"==typeof console.log),o=a&&!("unknown"==typeof console.log.apply||"undefined"==typeof console.log.apply);return{h:e,d:t,w:n}}function $yvGroupMembersCtrl(e,t,n,r,s,a,o){e.members={members:[],add:{members:[],total_items:0,items_per_page:12,search_value:"",page_number:1,selected_all:{selected:!1},add:null},total_items:0,items_per_page:12,search_value:"",page_number:1,selected_all:{selected:!1},remove:null},e.add_group_user=function(){e.members.add.add&&e.members.add.add.length>0&&r.add_org_group_user({app_uuid:s.get_team().uuid,group_uuid:t.group_uuid,user_list:e.members.add.add}).success(function(t){0==t.error_code?(e.toast_success_string("ADD_SUCCESSFULLY_TAG"),e.page_group_user()):e.toast_error_string("ADD_FAILED_TAG")}).error(function(){e.toast_error_string("ADD_FAILED_TAG")}),jQuery("#add_group_user").modal("hide")},e.show_add_modal=function(){e.page_no_group_user(),jQuery("#add_group_user").modal({show:!0})},e.should_enable_add_button=function(){var t=[];return angular.forEach(e.members.add.members,function(e){e.selected&&this.push(e.uuid)},t),t.length>0&&(e.members.add.add=angular.copy(t),!0)},e.should_show_remove_button=function(){var t=[];return angular.forEach(e.members.members,function(e){e.selected&&this.push(e)},t),t.length>0&&(e.members.remove=angular.copy(t),!0)},e.check_all_changed=function(e,t){angular.forEach(e,function(e){e.selected=t})},e.page_no_group_user=function(a){var _=e.members.add.search_value||"",i=e.members.add.page_number=a||1;r.get_no_group_user_list({app_uuid:s.get_team().uuid,group_uuid:t.group_uuid}).success(function(t){if(0==t.error_code){var r=o.pagination({members:t.list,filter_keys:["user_fullname","user_email"],filter_value:$.trim(_),page_offset:i-1,page_size:e.members.add.items_per_page});n(function(){e.members.add.members=r.page,e.members.add.total_items=r.total})}else e.members.add.members=[],e.members.add.total_items=0}).error(function(){e.members.add.members=[],e.members.add.total_items=0})},e.page_group_user=function(a){var _=e.members.search_value||"",i=e.members.page_number=a||1;r.get_org_group_user_list({app_uuid:s.get_team().uuid,group_uuid:t.group_uuid}).success(function(t){if(0==t.error_code){var r=o.pagination({members:t.list,filter_keys:["user_fullname","user_email"],filter_value:$.trim(_),page_offset:i-1,page_size:e.members.items_per_page});n(function(){e.members.members=r.page,e.members.total_items=r.total})}else e.members.members=[],e.members.total_items=0}).error(function(){e.members.members=[],e.members.total_items=0})};var _=function(){var t=s.get_team();return null==t?void console.error("no team info"):void e.page_group_user()},i=function(){a.prepare(function(e){_()},{$scope:e,onRefresh:_})},u=function(){console.log(t),e.refresh_settings_menu(),i()};u()}!function(){window&&void 0===window.ppconsole&&(window.ppconsole={version:"0.0.0.2"})}(),function(){for(var e,t=function(){},n=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],r=n.length,s=window.console=window.console||{};r--;)e=n[r],s[e]||(s[e]=t)}(),angular.module("this_app.constants",[]).constant("yvConstants",{PPCONSOLE_API:{uuid:"{ppconsole_api_uuid}",key:"{ppconsole_api_key}",secret:"{ppconsole_api_secret}"},PPMESSAGE_APP:{uuid:"{ppmessage_app_uuid}"},COOKIE_KEY:{LOGINED_USER_UUID:"cookie_ppconsole_user_logined_user_uuid",ACTIVE_USER_UUID:"cookie_ppconsole_user_user_uuid",ACCESS_TOKEN:"cookie_ppconsole_user_access_token"},BROADCAST_EVENT_KEY:{LOGIN_FINISHED:"event:login:finished",REFRESH_PAGE:"event:refreshpage"},MAX_TEXT_LEN:128,TEMPLATE_PREFIX:"templates/",STATIC_PREFIX:"/ppconsole/static/",DEFAULT_USER_ICON:"/ppconsole/static/img/default-user.png",MESSAGE_TYPE:{NOTI:"NOTI"},MESSAGE_SUBTYPE:{AUDIO:"AUDIO",VIDEO:"VIDEO",DOCUMENT:"DOCUMENT",FILE:"FILE",TEXT:"TEXT",IMAGE:"IMAGE",SINGLE_CARD:"SINGLE_CARD",MULTIPLE_CARD:"MULTIPLE_CARD",TXT:"TXT",MENU:"MENU",EVENT:"EVENT",GPS_LOCATION:"GPS_LOCATION",INVITE_CONTACT:"INVITE_CONTACT",ACCEPT_CONTACT:"ACCEPT_CONTACT",REMOVE_CONTACT:"REMOVE_CONTACT",DG_INVITED:"DG_INVITED",DG_REMOVED:"DG_REMOVED",REQUEST_JOIN_OG:"REQUEST_JOIN_OG",APPROVE_JOIN_OG:"APPROVE_JOIN_OG",LOGOUT:"LOGOUT"},YVOBJECT:{DU:"DU",AU:"AU",AG:"AG",OG:"OG"},OS:{IOS:"IOS",AND:"AND",WP:"WP",CHROME:"CHROME",MAC:"MAC",WIN:"WIN"},SEND_STATUS:{SEND_PENDING:"SEND_PENDING",SEND_CHECKING:"SEND_CHECKING",SEND_UPLOADING:"SEND_UPLOADING",SEND_SENDING:"SEND_SENDING",SEND_SUCCESS:"SEND_SUCCESS",SEND_ERROR:"SEND_ERROR"},MESSAGE_DIR:{DIR_IN:"DIR_IN",DIR_OUT:"DIR_OUT"},USER_STATUS:{OWNER_0:"app.main",OWNER_1:"app.main",OWNER_2:"app.settings.overview",ANONYMOUS:"app.main",THIRDPARTY:"app.main"}}),angular.module("this_app.i18n",["pascalprecht.translate"]).constant("yvTransTags",{en:{COPYRIGHT_PPMESSAGE:"PPMESSAGE.",action:{ADD_TAG:"Add",CANCEL_TAG:"Cancel",CONFIRM_TAG:"Confirm",CREATE_TAG:"Create",DELETE_TAG:"Delete",PREVIEW_TAG:"Preview",SAVE_TAG:"Save",SEARCH_TAG:"Search",SELECT_ALL_TAG:"Select all",SUBMIT_TAG:"Submit"},field:{CURRENT_PASSWORD_TAG:"Current password",NEW_PASSWORD_TAG:"New password",REPEAT_NEW_PASSWORD_TAG:"Repeat new password",SERVICE_GROUP_NAME_TAG:"Group name",SERVICE_GROUP_DESC_TAG:"Group description",TEAM_NAME_TAG:"Team name",USER_FULLNAME_TAG:"User fullname",USER_EMAIL_TAG:"User email",USER_PASSWORD_TAG:"User password",MEMBERS_TAG:"members"},error:{ADD_FAILED_TAG:"Add failed.",EMAIL_TAKEN_TAG:"This email already has been taken.",ILLEGAL_CHARACTER_FOUND_TAG:"Illegal character found.",NEWPASSWORD_MISMATCH_TAG:"New password and repeat not equal.",NOTHING_CHANGED_TAG:"Nothing changed.",OLDPASSWORD_MISMATCH_TAG:"Old password mismatch.",OUT_OF_LENGTH_TAG:"Out of length.",PARAMS_MISS_TAG:"Parameters missed.",PASSWORD_NOT_MATCHED_TAG:"Password not matched",SIGNIN_FAILED_TAG:"Sign in failed.",UPDATE_FAILED_TAG:"Failed to update.",DELETE_SUCCESSFULLY_TAG:"Failed to delete"},success:{ADD_SUCCESSFULLY_TAG:"Add successfully.",CHANGE_PASSWORD_SUCCESS_TAG:"Change password successfully.",CHANGE_PASSWORD_FAIL_TAG:"Change password failed.",DELETE_SUCCESSFULLY_TAG:"Delete successfully.",REMOVE_SUCCESSFULLY_TAG:"Remove successfully.",UPDATE_SUCCESSFULLY_TAG:"Update successfully.",CREATE_SUCCESSFULLY_TAG:"Create successfully."},global:{ADD_GROUP_USER_TAG:"Add user to this group",CHANGE_PASSWORD_TAG:"Change Password",COLOR_PICKED_NOT_RIGHT_TAG:"color picked is unregualr value",COLOR_TAG:"Color",COPY_CODE_TO_BODY:"Copy the code below, and paste it into html body.",CREATE_TEAM_TAG:"Create Team",CREATE_SERVICE_GROUP_TAG:"Create Service Group",DELETE_SERVICE_GROUP_TAG:"Delete Service Group",DELETE_SERVICE_GROUP_INFO_TAG:"Confirm delete the following groups:",DEMO_DEPLOY_TO:"PPMessage has deploy to this website for preview",EDIT_SERVICE_GROUP_TAG:"Edit Service Group",PRIVATE_SETTINGS_TAG:"Private settings",RESET_PASSWORD_TAG:"Reset Password",SERVICE_TEAM_TAG:"Service Team",SIGNUP_TAG:"Sign up",SIGNIN_TAG:"Sign in",SIGNOUT_TAG:"Sign out",SLOGAN_TAG:"Open Source Plug & Play Enterprise Message Communication Platform",START_SERVICE_TAG:"Start service",TEAM_CONFIG_TAG:"Team settings",USER_ACCOUNT_TAG:"User Account",WELCOME_TAG:"Welcome"},calendar:{TODAY_TAG:"Today",YESTERDAY_TAG:"Yesterday",LAST_7_DAYS_TAG:"Last 7 Days",LAST_30_DAYS_TAG:"Last 30 Days",THIS_MONTH_TAG:"This Month",LAST_MONTH_TAG:"Last Month",APPLY_LABEL_TAG:"Apply",CANCEL_LABEL_TAG:"Cancel",FROM_LABEL_TAG:"From",TO_LABEL_TAG:"To",CUSTOM_RANGE_LABEL_TAG:"Custom Range",monthname:{JANUARY_TAG:"January",FEBRUARY_TAG:"February",MARCH_TAG:"March",APRIL_TAG:"April",MAY_TAG:"May",JUNE_TAG:"June",JULY_TAG:"July",AUGUST_TAG:"August",SEPTEMBER_TAG:"September",OCTOBER_TAG:"October",NOVEMBER_TAG:"November",DECEMBER_TAG:"December"}},settings:{menu:{DATA_ANALYSIS_TAG:"Data analysis",DATA_OVERVIEW_TAG:"Data overview",HISTORY_MSG_TAG:"Message history",TEAM_CONFIG_TAG:"Team settings",BASIC_CONFIG_TAG:"Basic info",USER_INTERFACE_TAG:"User interface",MESSAGE_DISPATCH_TAG:"Message dispatch",SERVICE_USER_TAG:"Service users",SERVICE_GROUP_TAG:"Service groups",APP_INTEGRAGE_TAG:"App integrate",ACCOUT_CONFIG_TAG:"Account settings",ADVANCED_CONFIG_TAG:"Advanced settings",PUSH_CONFIG_TAG:"Push settings"}},application:{people:{CREATE_APP_USER_SUCCESSFULLY_TAG:"Add user successfully.",CREATE_APP_USER_FAILED_TAG:"Add user failed.",USER_EXIST_AND_INVITE_TAG:"user existed,please invite directly",REMOVE_APP_USER_SUCCESSFULLY_TAG:"Remove successfully.",REMOVE_APP_USER_FAILED_TAG:"Remove failed.",ALREADY_IS_APP_USER_TAG:"This user has already been app user.",QUOTA_REACH_TO_UPPER_LIMIT_TAG:"Agent quote reach to upper limit.",CREATE_SERVICE_USER_TAG:"Create service user",EDIT_SERVICE_USER_TAG:"Edit",REMOVE_SERVICE_USER_TAG:"Remove",REMOVE_SERVICE_USER_PROMOTE_TAG:"Are you sure to remove the service user: ",OWNER_TAG:"Owner",SERVICE_USER_TAG:"Service user",SERVICE_USER_NAME_TAG:"Service user full name",SERVICE_USER_EMAIL_TAG:"Email",CONFIRM_PASSWORD_TAG:"Confirm password"}},statistics:{overview:{OVERVIEW_TAG:"Overview",TODAY_CUSTOMER_TAG:"Today customer",YESTERDAY_CUSTOMER_TAG:"Yesterday customer",ALL_CUSTOMER_TAG:"All customer",ALL_MESSAGE_TAG:"All message",REALTIME_DATA_TAG:"Today data",REALTIME_CUSTOMER_TAG:"Customer",REALTIME_SERVICE_TAG:"Service",REALTIME_MESSAGE_TAG:"Message",HISTORY_DATA_TAG:"History data",HISTORY_CUSTOMER_TAG:"Customer",HISTORY_SERVICE_TAG:"Service",HISTORY_MESSAGE_TAG:"Message",MAX_RANGE_TAG:"Less than 30 days"},historymessages:{MESSAGE_FILE_TYPE_TAG:"File",MESSAGE_IMAGE_TYPE_TAG:"Image",MESSAGE_TXT_TYPE_TAG:"Large text",MESSAGE_GET_ERROR_TAG:"Get history message error.",SEARCH_TAG:"Search",MESSAGE_LIST_TAG:"Messages",EMPTY_LIST_TAG:"Empty",MESSAGES:"Messages",MESSAGES_PREVIEW:"Messages preview"}}},cn:{COPYRIGHT_PPMESSAGE:"皮皮消息.",action:{ADD_TAG:"添加",CANCEL_TAG:"取消",CONFIRM_TAG:"确认",CREATE_TAG:"创建",DELETE_TAG:"删除",PREVIEW_TAG:"预览",SAVE_TAG:"保存",SEARCH_TAG:"搜索",SELECT_ALL_TAG:"全选",SUBMIT_TAG:"提交"},field:{CURRENT_PASSWORD_TAG:"当前密码",NEW_PASSWORD_TAG:"新密码",SERVICE_GROUP_NAME_TAG:"组名字",SERVICE_GROUP_DESC_TAG:"组描述",TEAM_NAME_TAG:"团队名称",USER_FULLNAME_TAG:"用户姓名",USER_EMAIL_TAG:"用户邮箱",USER_PASSWORD_TAG:"用户密码",MEMBERS_TAG:"成员"},error:{ADD_FAILED_TAG:"添加成功",EMAIL_TAKEN_TAG:"这个 Email 地址已经被别人使用了",ILLEGAL_CHARACTER_FOUND_TAG:"发现了非法字符",NEWPASSWORD_MISMATCH_TAG:"新密码和重复新密码不一致",NOTHING_CHANGED_TAG:"什么都没有改变",OLDPASSWORD_MISMATCH_TAG:"旧密码错误",OUT_OF_LENGTH_TAG:"超出长度限制",PARAMS_MISS_TAG:"缺参数",PASSWORD_NOT_MATCHED_TAG:"密码不匹配",SIGNIN_FAILED_TAG:"登入失败",UPDATE_FAILED_TAG:"更新失败",CREATE_FAILED_TAG:"创建失败"},success:{ADD_SUCCESSFULLY_TAG:"添加成功",CHANGE_PASSWORD_SUCCESS_TAG:"改密码成功",CHANGE_PASSWORD_FAIL_TAG:"改密码失败",REMOVE_SUCCESSFULLY_TAG:"删除成功",UPDATE_SUCCESSFULLY_TAG:"更新成功",CREATE_SUCCESSFULLY_TAG:"创建成功"},global:{ADD_GROUP_USER_TAG:"添加用户到此组",CHANGE_PASSWORD_TAG:"更改密码",COLOR_PICKED_NOT_RIGHT_TAG:"选取颜色异常",COLOR_TAG:"颜色",COPY_CODE_TO_BODY:"复制下面的代码并置于您自己网站的 HTML 文件之中，确保在 <body> ... </body> 元素之间",CREATE_TEAM_TAG:"创建客服团队",CREATE_SERVICE_GROUP_TAG:"创建客服分组",DELETE_SERVICE_GROUP_TAG:"删除客服分组",DELETE_SERVICE_GROUP_INFO_TAG:"确认删除以下客服分组：",DEMO_DEPLOY_TO:"在这个网页可以查看部署效果",EDIT_SERVICE_GROUP_TAG:"编辑客服分组",PRIVATE_SETTINGS_TAG:"个人设置",RESET_PASSWORD_TAG:"重设密码",SERVICE_TEAM_TAG:"客服团队",SIGNUP_TAG:"注册",SIGNIN_TAG:"登入",SIGNOUT_TAG:"登出",SLOGAN_TAG:"Open Source Plug & Play Enterprise Message Communication Platform",START_SERVICE_TAG:"开始服务",TEAM_CONFIG_TAG:"团队设置",USER_ACCOUNT_TAG:"用户账户",WELCOME_INFO_TAG:"欢迎信息"},calendar:{TODAY_TAG:"今天",YESTERDAY_TAG:"昨天",LAST_7_DAYS_TAG:"最近7天",LAST_30_DAYS_TAG:"最近30天",THIS_MONTH_TAG:"本月",LAST_MONTH_TAG:"上一个月",APPLY_LABEL_TAG:"应用",CANCEL_LABEL_TAG:"取消",FROM_LABEL_TAG:"从",TO_LABEL_TAG:"到",CUSTOM_RANGE_LABEL_TAG:"定制范围",monthname:{JANUARY_TAG:"一月",FEBRUARY_TAG:"二月",MARCH_TAG:"三月",APRIL_TAG:"四月",MAY_TAG:"五月",JUNE_TAG:"六月",JULY_TAG:"七月",AUGUST_TAG:"八月",SEPTEMBER_TAG:"九月",OCTOBER_TAG:"十月",NOVEMBER_TAG:"十一月",DECEMBER_TAG:"十二月"}},settings:{menu:{DATA_ANALYSIS_TAG:"数据分析",DATA_OVERVIEW_TAG:"数据总览",HISTORY_MSG_TAG:"历史消息",TEAM_CONFIG_TAG:"团队设置",BASIC_CONFIG_TAG:"基本信息",USER_INTERFACE_TAG:"用户界面",MESSAGE_DISPATCH_TAG:"消息分流",SERVICE_USER_TAG:"客服人员",SERVICE_GROUP_TAG:"客服分组",APP_INTEGRAGE_TAG:"应用集成",ACCOUT_CONFIG_TAG:"账户设置",ADVANCED_CONFIG_TAG:"高级设置",PUSH_CONFIG_TAG:"推送设置"}},statistics:{overview:{OVERVIEW_TAG:"数据总览",TODAY_CUSTOMER_TAG:"今日访客",YESTERDAY_CUSTOMER_TAG:"昨日访客",ALL_CUSTOMER_TAG:"累计访客",ALL_MESSAGE_TAG:"累计消息",REALTIME_DATA_TAG:"实时统计",REALTIME_CUSTOMER_TAG:"访客",REALTIME_SERVICE_TAG:"客服",REALTIME_MESSAGE_TAG:"消息",HISTORY_DATA_TAG:"历史统计",HISTORY_CUSTOMER_TAG:"访客",HISTORY_SERVICE_TAG:"客服",HISTORY_MESSAGE_TAG:"消息",MAX_RANGE_TAG:"最多30天"},historymessages:{MESSAGE_FILE_TYPE_TAG:"文件",MESSAGE_IMAGE_TYPE_TAG:"图片",MESSAGE_TXT_TYPE_TAG:"文本消息",MESSAGE_GET_ERROR_TAG:"获取历史信息错误",SEARCH_TAG:"搜索",MESSAGE_LIST_TAG:"消息列表",EMPTY_LIST_TAG:"没有任何匹配的会话",MESSAGES:"条消息",MESSAGES_PREVIEW:"消息预览"}}}}).config(["$translateProvider","yvTransTags",function(e,t){e.translations("en",t.en),e.translations("zh-CN",t.cn),e.registerAvailableLanguageKeys(["en","zh-CN"],{en:"en","en-US":"en","en-UK":"en","zh-CN":"zh-CN"}),e.determinePreferredLanguage(function(){return window.navigator.userLanguage||window.navigator.language}),e.fallbackLanguage("en","zh-CN")}]),angular.module("this_app.route",["ui.router","this_app.constants"]).config(["$stateProvider","$urlRouterProvider","yvConstants","blockUIConfig",function(e,t,n,r){r.autoInjectBodyBlock=!1,e.state("forget",{url:"/forget",templateUrl:n.TEMPLATE_PREFIX+"forget.html",controller:"ForgetCtrl"}).state("app",{"abstract":!0,url:"/app",templateUrl:n.TEMPLATE_PREFIX+"app.html",controller:"AppCtrl"}).state("app.signin",{url:"/signin",templateUrl:n.TEMPLATE_PREFIX+"signin.html",controller:"SignInCtrl"}).state("app.error",{url:"/error",templateUrl:n.TEMPLATE_PREFIX+"404.html",controller:"ErrorCtrl"}).state("app.createaccount",{url:"/createaccount/:account",templateUrl:n.TEMPLATE_PREFIX+"createaccount.html",controller:"CreateAccountCtrl"}).state("app.recoverpassword",{url:"/recoverpassword/:account",templateUrl:n.TEMPLATE_PREFIX+"recoverpassword.html",controller:"RecoverPasswordCtrl"}).state("app.resetpassword",{url:"/resetpassword/:email",templateUrl:n.TEMPLATE_PREFIX+"settings/resetpassword.html",controller:"SettingsResetpasswordCtrl"}).state("app.confirmreset",{url:"/confirmreset",templateUrl:n.TEMPLATE_PREFIX+"settings/confirmreset.html",controller:"SettingsConfirmresetCtrl"}).state("app.settings.teamprofile",{url:"/teamprofile",templateUrl:n.TEMPLATE_PREFIX+"settings/teamprofile.html",controller:"ApplicationProfileCtrl"}).state("app.settings.configuration",{url:"/configuration",templateUrl:n.TEMPLATE_PREFIX+"settings/welcome.html",controller:"ApplicationWelcomeCtrl"}).state("app.settings.group",{url:"/group",templateUrl:n.TEMPLATE_PREFIX+"settings/group.html",controller:"GroupCtrl"}).state("app.settings.groupmembers",{url:"/groupmembers/:group_uuid",templateUrl:n.TEMPLATE_PREFIX+"settings/groupmembers.html",controller:"GroupMembersCtrl"}).state("app.glance",{url:"/glance",templateUrl:n.TEMPLATE_PREFIX+"settings/glance.html",controller:"GlanceCtrl"}).state("app.settings.teampeople",{url:"/teampeople",templateUrl:n.TEMPLATE_PREFIX+"settings/people.html",controller:"ApplicationPeopleCtrl"}).state("app.settings.messageroute",{url:"/messageroute",templateUrl:n.TEMPLATE_PREFIX+"settings/messageroute.html",controller:"ApplicationMessageRouteCtrl"}).state("app.settings.overview",{url:"/overview",templateUrl:n.TEMPLATE_PREFIX+"settings/overview.html",controller:"StatisticsOverviewCtrl"}).state("app.settings.historymessage",{url:"/historymessage",templateUrl:n.TEMPLATE_PREFIX+"settings/historymessage.html",controller:"StatisticsHistoryMessageCtrl"}).state("app.settings.integrate",{url:"/integrate",templateUrl:n.TEMPLATE_PREFIX+"settings/integrate.html",controller:"IntegrateCtrl"}).state("app.settings",{"abstract":!0,url:"/settings",templateUrl:n.TEMPLATE_PREFIX+"settings/settings.html",controller:"SettingsCtrl"}).state("app.settings.profile",{url:"/profile",templateUrl:n.TEMPLATE_PREFIX+"settings/userprofile.html",controller:"SettingsProfileCtrl"}).state("app.settings.account",{url:"/account",templateUrl:n.TEMPLATE_PREFIX+"settings/account.html",controller:"SettingsAccountCtrl"}).state("app.settings.push",{url:"/push",templateUrl:n.TEMPLATE_PREFIX+"settings/push.html",controller:"SettingsPushCtrl"}),t.otherwise("/app/signin")}]),angular.module("this_app.services",[]),angular.module("this_app",["base64","ngCookies","toastr","blockUI","angularUtils.directives.dirPagination","angularFileUpload","ui.router","ngMaterial","ngFileUpload","this_app.constants","this_app.i18n","this_app.route","this_app.services"]).run(["$rootScope","$location","$timeout",function(e,t,n){window.PP&&PP.boot({app_uuid:"a600998e-efff-11e5-9d9f-02287b8c0ebf"},function(e,t){console.log("PPCOM boot: ",t)})}]),$yvPaginationService.$inject=[],angular.module("this_app.services").factory("yvPagination",$yvPaginationService),$yvAjaxService.$inject=["$state","$timeout","$http","$cookies","yvUser","yvConstants","yvUtil","yvLog","yvDebug"],angular.module("this_app.services").factory("yvAjax",$yvAjaxService),$yvUserService.$inject=[],angular.module("this_app.services").factory("yvUser",$yvUserService),$yvMime.$inject=[],angular.module("this_app").factory("yvMime",$yvMime),$yvUtilService.$inject=["$rootScope","$translate","$http","$base64","yvConstants","yvLog"],angular.module("this_app.services").factory("yvUtil",$yvUtilService),angular.module("this_app").factory("yvType",["yvConstants",function(e){function t(e){return e.message_subtype?e.message_subtype:e.ms?e.ms:null}return{is_logout:function(n){var r=t(n);return r===e.MESSAGE_SUBTYPE.LOGOUT},is_document:function(n){var r=t(n);return r===e.MESSAGE_SUBTYPE.DOCUMENT},is_file:function(n){var r=t(n);return r===e.MESSAGE_SUBTYPE.DOCUMENT||r===e.MESSAGE_SUBTYPE.FILE},is_video:function(n){var r=t(n);return r===e.MESSAGE_SUBTYPE.VIDEO},is_single_card:function(n){var r=t(n);return r===e.MESSAGE_SUBTYPE.SINGLE_CARD},is_multiple_card:function(n){var r=t(n);return r===e.MESSAGE_SUBTYPE.MULTIPLE_CARD},is_text:function(n){var r=t(n);return r===e.MESSAGE_SUBTYPE.TEXT},is_txt:function(n){var r=t(n);return r===e.MESSAGE_SUBTYPE.TXT},is_image:function(n){var r=t(n);return r===e.MESSAGE_SUBTYPE.IMAGE},is_gps_location:function(n){var r=t(n);return r===e.MESSAGE_SUBTYPE.GPS_LOCATION},is_audio:function(n){var r=t(n);return r===e.MESSAGE_SUBTYPE.AUDIO},is_left:function(t){return t.message_direction===e.MESSAGE_DIR.DIR_IN},is_right:function(t){return t.message_direction===e.MESSAGE_DIR.DIR_OUT},is_left_audio:function(e){return!(!this.is_left(e)||!this.is_audio(e))},is_right_audio:function(e){return!(!this.is_right(e)||!this.is_audio(e))}}}]),$yvLog.$inject=[],angular.module("this_app.services").factory("yvLog",$yvLog),function(){function e(e){function t(e,t){return void 0!==window&&n&&void 0!==e&&(window[e]=t),r}var n=!0,r={attach:t,h:e.h,d:e.d,w:e.w};return r}e.$inject=["yvLog"],angular.module("this_app.services").factory("yvDebug",e)}(),function(){function e(e,t,n,r,s,a,o,_,i,u){function c(e,t){if(t&&t.$scope&&t.onRefresh){var r=t.$scope,a=r.$on(s.BROADCAST_EVENT_KEY.REFRESH_PAGE,function(){G(function(e){e===y.OK&&(n.d("===event:refreshpage==="),t.onRefresh())})});r.$on("$destroy",function(){n.d("===destroy==="),a&&a()})}T(function(){G(function(t){t===y.OK&&v(),e&&e(t)},t&&t.expectedStatus)})}function l(e){a.update(e),n.d("===logined user===",e)}function p(t){e.set_login_data(t),R=t,n.d("===active user===",t)}function g(e){u.put(s.COOKIE_KEY.ACTIVE_USER_UUID,e)}function m(e,t){u.put(s.COOKIE_KEY.ACCESS_TOKEN,t),u.put(s.COOKIE_KEY.LOGINED_USER_UUID,e)}function E(){return a.get()}function d(){return a.isLogined()}function A(e){if(a.setLogined(e),e){var t={isAdmin:a.isAdminUser()};o.$emit(s.BROADCAST_EVENT_KEY.LOGIN_FINISHED,t),n.d("===event:login finished===")}}function f(){a.logout(),R=null,e.logout(),u.remove(s.COOKIE_KEY.LOGINED_USER_UUID),u.remove(s.COOKIE_KEY.ACTIVE_USER_UUID),u.remove(s.COOKIE_KEY.ACCESS_TOKEN)}function T(e,t,n){return R?void(e&&e(R)):void h(s.COOKIE_KEY.ACTIVE_USER_UUID,function(t){p(t),G(e)},t,n)}function v(e,t,n){S(e,t,n)}function S(e,t,n){return a.get()?void(e&&e(a.get())):void h(s.COOKIE_KEY.LOGINED_USER_UUID,function(t){l(t),A(!0),e&&e(t)},function(){A(!1),t&&t()},n)}function h(e,n,r,s){var a=u.get(e);if(!a)return r?void r():void(s&&i(function(){_.go(s)}));a=a.replace(/\"/g,"");var o=t.get_user_detail_with_password(a);o.success(function(e){0==e.error_code?i(function(){
n&&n(e)}):r&&r()}),o.error(function(e){r&&r()})}function G(n,r){function s(e){n&&n(e)}var a=C.OWNER_2|C.ADMIN|C.OWNER_1;null!==r&&void 0!==r&&NaN!==r&&(a=r);var o=C[e.get_status()];if(void 0===o||o&1!==a)return void s(y.STATUS_ILLEGAL);if(e.get_team())s(y.OK);else{var _=t.get_app_owned_by_user(e.get_uuid());_.success(function(t){e.set_team(t.app),s(y.OK)})}}var R,y={OK:0,STATUS_ILLEGAL:1,LOGIN_ERROR:2},C={OWNER_0:1,OWNER_1:2,OWNER_2:4,ADMIN:8};return{ERROR_CODE:y,STATUS:C,prepare:c,updateLoginedUser:l,updateActiveUser:p,check_logined:S,checkActiveUser:T,checkLoginedUser:v,getLoginedUser:E,isLogined:d,setLogined:A,logout:f,updateActiveUserCookieKey:g,updateLoginedUserCookieKey:m}}e.$inject=["yvUser","yvAjax","yvDebug","yvAppService","yvConstants","yvLoginedUser","$rootScope","$state","$timeout","$cookies"],angular.module("this_app.services").factory("yvLogin",e)}(),function(){function e(e,t,n,r){function s(r,s){function a(e){var n=e.list||[];angular.forEach(n,function(e,n){e.is_owner_user=e.user_email===t.get_email()}),r&&r(n)}function o(e){s&&s([])}e.get_team_service_user_list({app_uuid:t.get_team().uuid}).success(function(e){n.response(angular.copy(e),a,o)}).error(o)}function a(e,t,r){s(function(r){var s=angular.extend({filter_keyword:"",length:c,start_page:0,sort:!0},e),a=_(s,r),o=a.length,l=i(s,u(s,a));n.success({users:l,total:o},t)},function(e){n.error(e,r)})}function o(t,r,a){s(function(n){e.create_user(t).success(r).error(a)},function(e){n.error(e,a)})}function _(e,t){if(""===e.filter_keyword)return t||[];var n=e.filter_keyword,r=new RegExp(".*"+n+".*","g"),s=[];return angular.forEach(t,function(e,t){(r.test(e.user_email)||r.test(e.user_fullname))&&s.push(e)}),s}function i(e,t){for(var n,r=e.length,s=e.start_page,a=(t.length,s*r),o=a+r,_=a,i=[];void 0!==(n=t[_++])&&_<=o;)i.push(n);return i}function u(e,t){function n(e,t){return e.updatetime>t.updatetime?-1:1}return e.sort?t.sort(n):t}var c=12;$;return{getAppServiceUsers:s,getAppServiceUsersWithPagination:a,createServiceUser:o}}e.$inject=["yvAjax","yvUser","yvCallbackService","yvDebug"],angular.module("this_app.services").factory("yvAppPeopleService",e)}(),function(){function e(){function e(e,r,s){e&&0===e.error_code?t(e,r):n(e,s)}function t(e,t){t&&t(e)}function n(e,t){t&&t(e)}return{response:e,success:t,error:n}}e.$inject=[],angular.module("this_app.services").factory("yvCallbackService",e)}(),function(){function e(e,t,n,r,s,a,o){function _(e){return o.get()&&o.isAdminUser()?p&&p.length>0?void(e&&e(p)):void t.get_all_apps({user_uuid:o.userUUID()}).success(function(t){if(0===t.error_code){var n=t.app;angular.forEach(n,function(e,t){e.is_selected=o.userUUID()===e.user_uuid}),p=n,e&&e(n)}else e&&e([])}).error(function(t){e&&e([])}):void(e&&e([]))}function i(e,n,r){if(angular.forEach(p,function(t,n){t.is_selected=t.uuid===e.uuid}),g[e.user_uuid]){var s=g[e.user_uuid];l(s.user_response),n&&n()}else t.get_user_detail_with_password(e.user_uuid).success(function(e){if(0===e.error_code){l(e);var t={user_response:e};g[e.uuid]=t,n&&n()}else r&&r(e)}).error(function(e){r&&r(e)})}function u(){var e;return angular.forEach(p,function(t,n){t.is_selected&&(e=t)}),e}function c(){p=[]}function l(e){n.set_login_data(e),n.set_team(null)}var p=[],g={};return{getApps:_,selectApp:i,activeApp:u,clear:c}}e.$inject=["yvDebug","yvAjax","yvUser","$cookies","$rootScope","yvConstants","yvLoginedUser"],angular.module("this_app.services").factory("yvAppService",e)}()+function(){function e(){function e(){return i}function t(e){i=e}function n(){return _}function r(e){_=e}function s(){_=null,i=!0}function a(){var e=!1;return n()&&"ADMIN"===n().user_status&&(e=!0),e}function o(){if(n())return n().uuid}var _,i=!1;return{isLogined:e,setLogined:t,get:n,update:r,logout:s,isAdminUser:a,userUUID:o}}e.$inject=[],angular.module("this_app.services").factory("yvLoginedUser",e)}(),angular.module("this_app").controller("LogoutCtrl",["$scope","$cookies","$state","$timeout","yvAjax",function(e,t,n,r,s){console.log("LOGOUT.................................."),s.logout(WebRole),delete t.PORTALUSER_SESSION_ID,delete t.PORTALADMIN_SESSION_ID,r(function(){n.go("app.main",null,{reload:!0})},100)}]),angular.module("this_app").controller("SignInCtrl",["$scope","$state","$stateParams","$timeout","$translate","$cookieStore","yvAjax","yvUtil","yvUser","yvTransTags","yvConstants","yvDebug","yvLogin","yvAppService",function(e,t,n,r,s,a,o,_,i,u,c,l,p,g){e.user={user_status:"OWNER_2",is_service_user:!1,user_fullname:"",user_email:"",user_password:"",app_name:"",user_password_is_visible:!1,password_input_type:"password"};var m=function(n){var r=sha1(e.user.user_password);o.login({user_email:e.user.user_email,user_password:r}).success(function(n){0==n.error_code?(p.updateActiveUserCookieKey(n.user_uuid),p.updateLoginedUserCookieKey(n.user_uuid,n.access_token),o.get_user_detail_with_password(n.user_uuid).success(function(n){if(l.d("get_user_detail",n),0!=n.error_code)return void yvLog.w("get detail failed %s",n);p.updateLoginedUser(angular.copy(n)),p.setLogined(!0);var r=c.USER_STATUS[n.user_status];return"SERVICE"==n.user_status?(p.updateActiveUser(n),void e.start_ppmessage(!0)):("OWNER_2"==n.user_status&&t.go(r),void l.d("do not know how to handle user_status: %s",n.user_status))})):e.toast_error_string("SIGNIN_FAILED_TAG")}).error(function(t){e.toast_error_string("SIGNIN_FAILED_TAG")})};e.sign_in_form_submit=function(){m(e.user)},e.show_user_password=function(t){t?(e.user.user_password_is_visible=!0,e.user.password_input_type="text"):(e.user.user_password_is_visible=!1,e.user.password_input_type="password")}}]),angular.module("this_app").controller("AppCtrl",["$window","$scope","$rootScope","$location","$state","$translate","$timeout","$cookies","$filter","toastr","yvAjax","yvUser","yvUtil","yvDebug","yvLogin","yvAppService","yvConstants","yvLoginedUser","yvTransTags",function(e,t,n,r,s,a,o,_,i,u,c,l,p,g,m,E,d,A,f){t._languages=[{lang:"zh-CN"},{lang:"en"}];var T=m.isLogined();t.menuStyle={"margin-top":"24px"};t.toggle_mobile_menu=function(e){$(".mobile-menu").hasClass("active")?($(".mobile-menu").removeClass("active"),$(".mobile-menu-items").removeClass("active")):($(".mobile-menu").addClass("active"),$(".mobile-menu-items").addClass("active"))},t.click_mobile_items=function(e){$(".mobile-menu").hasClass("active")&&($(".mobile-menu").removeClass("active"),$(".mobile-menu-items").removeClass("active"))},t.switch_to=function(e){var t="app."+e;s.go(t)},t.main=function(){window.open("https://ppmessage.com")},t.switch_to_english=function(){l.set_language("en"),a.use("en")},t.switch_to_chinese=function(){l.set_language("zh-CN"),a.use("zh-CN")},t.is_lang_english=function(){var e=l.get_language();return null==e||"en"==e},t.get_user_fullname=function(){return m.getLoginedUser()?m.getLoginedUser().user_fullname:""},t.is_logined=function(){return T},t.login=function(){s.go("app.signin")},t.show_settings_menu=function(){return A.get()&&"OWNER_2"===A.get().user_status},t.start_ppmessage=function(e){var t=l.get_uuid(),n=l.get_password(),r=l.get_email(),s={user_email:r,user_password:n,user_uuid:t};console.log("autologin with: %s",s),s=p.base64_encode(JSON.stringify(s));var a=p.http_protocol(location.hostname),o=a+location.host+"/ppkefu/#/noapp/auto-login/"+s;e?self.location=o:window.open(o,"ppmessage-"+r)},t.logout=function(){c.logout("user");o(function(){m.logout(),T=!1,E.clear(),t.menuStyle["margin-top"]="24px",t.isAdminUser=!1}),o(function(){s.go("app.signin")})},t.toast_error_string=function(e){var t=i("translate")("error."+e);o(function(){u.error(t)})},t.toast_success_string=function(e){var t=i("translate")("success."+e);o(function(){u.success(t)})},t.$on("$destroy",function(){}),n.$on(d.BROADCAST_EVENT_KEY.LOGIN_FINISHED,function(e,t){T=!0})}]),angular.module("this_app").controller("SettingsCtrl",["$scope","$rootScope","$cookies","$state","$timeout","$translate","yvAjax","yvUtil","yvUser","yvConstants","yvDebug",function(e,t,n,r,s,a,o,_,i,u,c){e.left_style=null,e.right_style=null,e.icon_style=null,e.should_show_update_string=function(){return e._update_string&&e._update_string.length>0},e.get_update_string=function(){return e._update_string},e.close_update_string=function(){s(function(){e._update_string=""})},e.set_update_string=function(t){s(function(){e._update_string=t}),s(function(){e._update_string=""},5e3)},e.set_flash_style=function(t){var n=[{left_style:"toast-style-success-l",right_style:"toast-style-success-r",icon_style:"glyphicon glyphicon-ok"},{left_style:"toast-style-warning-l",right_style:"toast-style-warning-r",icon_style:"glyphicon glyphicon-info-sign"},{left_style:"toast-style-fail-l",right_style:"toast-style-fail-r",icon_style:"glyphicon glyphicon-remove"}];s(function(){var r=n[t];e.left_style=r.left_style,e.right_style=r.right_style,e.icon_style=r.icon_style})},e.get_left_flash_style=function(){return e.left_style},e.get_right_flash_style=function(){return e.right_style},e.get_icon=function(){return e.icon_style},e.action_toast=function(t,n,r){e.set_flash_style(n),e.set_update_string(t.lang[r])};var l=function(){e._update_string=""},p=function(e){return"app.settings.groupmembers"==e?"app.settings.group":e};e.refresh_settings_menu=function(){for(var e=angular.element(".menu-item"),t=0;t<e.length;t++)angular.element(e[t]).removeClass("selected");var n=p(r.current.name);e=document.getElementById(n),e&&e.className&&e.className.indexOf("selected")<0&&(e.className+=" selected")},l()}]),angular.module("this_app").controller("ApplicationProfileCtrl",["$scope","$stateParams","$state","$translate","$timeout","yvTransTags","yvAjax","yvUtil","yvUser","yvDebug","yvConstants","yvLogin",function(e,t,n,r,s,a,o,_,i,u,c,l){var p="";e.can_delete=!1,e.team_info={};var g=function(){e.team_info={app_uuid:null,app_name:null,ppcom:{api_uuid:null,api_key:null,api_secret:null},ppconsole_thirdparty:{api_uuid:null,api_key:null,api_secret:null},ppkefu_thirdparty:{api_uuid:null,api_key:null,api_secret:null}}},m=function(){return p==e.team_info.app_name?(e.toast_error_string("NOTHING_CHANGED_TAG"),!1):_.regexp_check(e.team_info.app_name)?!(String(e.team_info.app_name).length>63)||(e.toast_error_string("OUT_OF_LENGTH_TAG"),e.team_info.app_name=p,!1):(e.toast_error_string("NOT_REGULAR_WORDS_TAG"),e.team_info.app_name=p,!1)};e.modify=function(){if(console.log("$scope.team_info is",e.team_info),m()){var t={app_uuid:i.get_team().uuid,app_name:e.team_info.app_name};o.update_app_info(t).success(function(t){console.log("update team info back",t),0==t.error_code?(e.team_info.app_name=t.app_name,p=t.app_name,i&&i.get_team()&&(i.get_team().app_name=p),e.toast_success_string("UPDATE_SUCCESSFULLY_TAG")):t.error_code==-1?$socpe.toast_error_string("LACK_PARAMS_TAG"):1==t.error_code?e.toast_error_string("TEAM_NOT_EXISTED_TAG"):e.toast_error_string("UPDATE_FAILED_TAG")}).error(function(t){console.log("error data is",t),e.toast_error_string("UPDATE_FAILED_TAG")})}};var E=function(){var t=i.get_team();if(null==t)return void console.error("no team info");var n=t.uuid;e.team_info.app_uuid=n,e.team_info.app_name=t.app_name;var r=o.get_api_info({app_uuid:n,user_uuid:i.get_uuid()});r.success(function(t){e.team_info.ppcom=t.ppcom,e.team_info.ppconsole_thirdparty=t.ppconsole_thirdparty,e.team_info.ppkefu_thirdparty=t.ppkefu_thirdparty})},d=function(){l.prepare(function(e){E()},{$scope:e,onRefresh:function(){E()}})},A=function(){g(),e.refresh_settings_menu(),d()};A(),u.attach("yvBasicInfo",{yvUser:i})}]),angular.module("this_app").controller("IntegrateCtrl",["$scope","$rootScope","$stateParams","$cookies","$state","$timeout","$http","$translate","yvTransTags","yvAjax","yvUtil","yvUser","yvConstants","yvLogin",function(e,t,n,r,s,a,o,_,i,u,c,l,p,g){e.enterprise={link:null,code:null};var m=function(){var t=l.get_team();if(null!=t){var n={uuid:t.uuid,app_name:encodeURI(t.app_name||"")},r=location.protocol+"//"+location.host+"/ppcom/enterprise/",s=c.base64_encode(JSON.stringify(n));a(function(){e.enterprise.link=r+s})}},E=function(){var t=l.get_team(),n=location.protocol+"//"+location.host,r="<script> window.ppSettings = {";r+="app_uuid:",r=r+"'"+t.uuid+"'};",r+="(function(){var w=window,d=document;function l(){var a=d.createElement('script');a.type='text/javascript';a.async=!0;a.src='{SERVER}/ppcom/assets/pp-library.min.js';var b=d.getElementsByTagName('script')[0];b.parentNode.insertBefore(a,b)}w.attachEvent?w.attachEvent('onload',l):w.addEventListener('load',l,!1);})()</script>",r=r.replace("{SERVER}",n),e.enterprise.code=r},d=function(){m(),E()},A=function(){g.prepare(function(e){d()},{$scope:e,onRefresh:d})},f=function(){var t,n=[];for(t in i.en.application.profile){var r="application.profile."+t;n.push(r)}e.translate=function(){},c.translate(e,"lang",n,e.translate)},T=function(){f(),e.refresh_settings_menu(),A()};T()}]),angular.module("this_app").controller("SettingsAccountCtrl",["$scope","$cookies","$state","$timeout","$translate","yvAjax","yvUtil","yvUser","yvTransTags","yvConstants","yvLogin","yvDebug",function(e,t,n,r,s,a,o,_,i,u,c,l){var p=function(t,n){e.set_flash_style(t),e.set_update_string(e.lang[n])},g=function(){e.user={user_password_is_visible:!1,password_input_type:"password"}};e.user={user_password_is_visible:!1,password_input_type:"password"},e.show_user_password=function(t){t?(e.user.user_password_is_visible=!0,e.user.password_input_type="text"):(e.user.user_password_is_visible=!1,e.user.password_input_type="password")},e.changepassword=function(e){if(e.user_new_password&&_.get_uuid()){var t,n=sha1(e.user_old_password);if(n!==_.get_password())t="settings.account.OLDPASSWORD_MISMATCH_TAG";else{var r=o.validator.validateRepeatPassword(e.user_new_password,e.user_new_password);switch(r){case o.validator.ERR_CODE.MIN_LENGTH_LIMIT:t="signup.NO_PASSWORD_TAG";break;case o.validator.ERR_CODE.MAX_LENGTH_LIMIT:t="signup.LENGTH_OUT_OF_RANGE_TAG";break;case o.validator.ERR_CODE.CONTAIN_WHITESPACE_AT_HEAD_OR_TAIL:t="signup.ERR_PASSWORD_CONTAINS_WHITESPACE_AT_HEAD_OR_TAIL";break;case o.validator.ERR_CODE.REPEAT_PASSWORD_MIS_MATCH:t="signup.PASSWORD_NOT_MATCHED_TAG"}}if(void 0!==t)return void p(1,t);var s={app_uuid:_.get_team().uuid,user_uuid:_.get_uuid(),user_password:sha1(e.user_new_password),old_password:n},i=a.update_user(s);i.success(function(t){0==t.error_code?(_.set_password(sha1(e.user_new_password)),p(0,"settings.profile.UPDATE_SUCCESSFULLY_TAG"),g()):(p(1,"settings.profile.UPDATE_FAILED_TAG"),g())}),i.error(function(){p(2,"settings.profile.UPDATE_FAILED_TAG"),g()})}};var m=function(){c.prepare(function(e){switch(e){case c.ERROR_CODE.OK:break;case c.ERROR_CODE.STATUS_ILLEGAL:}})},E=function(){var t=[];for(var n in i.en.settings.account){var r="settings.account."+n;t.push(r)}for(var n in i.en.settings.profile){var r="settings.profile."+n;t.push(r)}for(var n in i.en.signup){var r="signup."+n;t.push(r)}e.translate=function(){},o.translate(e,"lang",t,e.translate)},d=function(){e.refresh_settings_menu(),E(),m()};d()}]),angular.module("this_app").controller("SettingsProfileCtrl",["$scope","yvAjax","yvUtil","yvUser","yvTransTags","yvLogin",function(e,t,n,r,s,a){e.change=function(e){};var o=function(t,n){e.set_flash_style(t),e.set_update_string(e.lang[n])};e.submit=function(e){if(null!=e.fullname){var n={app_uuid:r.get_team().uuid,user_uuid:r.get_uuid(),user_fullname:e.fullname},s=t.update_user(n);s.success(function(t){console.log(t),0==t.error_code?(r.set_fullname(e.fullname),o(0,"settings.profile.UPDATE_SUCCESSFULLY_TAG")):o(1,"settings.profile.UPDATE_FAILED_TAG")}),s.error(function(e){o(2,"settings.profile.UPDATE_FAILED_TAG")})}};var _=function(){e.user={fullname:r.get_fullname(),email:r.get_email()}},i=function(){a.prepare(function(e){_()},{$scope:e,onRefresh:_})},u=function(){var t=[];for(var r in s.en.settings.profile){var a="settings.profile."+r;t.push(a)}e.translate=function(){console.log("trans lang %o",e.lang)},n.translate(e,"lang",t,e.translate)};_init=function(){e.refresh_settings_menu(),u(),i()},_init()}]),angular.module("this_app").controller("ApplicationPeopleCtrl",["$scope","$cookies","$stateParams","$state","$timeout","$translate","yvAjax","yvUtil","yvUser","yvTransTags","yvConstants","yvDebug","yvAppPeopleService","yvLogin",function(e,t,n,r,s,a,o,_,i,u,c,l,p,g){function m(){return{password:null,user_password_is_visible:!1,password_input_type:"password"}}function E(){var t=null;return angular.forEach(e.group,function(e){e.selected&&(t=e)}),null!=t&&(t.user_uuid=t.uuid,t.email=t.user_email,t.name=t.user_fullname,t.password=""),t}e.selected_all={seleted:!1},e.create_user_direct=m(),e.edit_user_direct=m();var d=function(t,n){e.set_flash_style(t),e.set_update_string(e.lang[n])};e.email_handler=function(e){return e.length<=22?e:e.substring(0,18)+".."},e.show_edit_modal=function(){jQuery("#batch_edit_user").modal({show:!0}),e.edit_user_direct=E()},e.show_create_modal=function(){jQuery("#batch_create_user").modal({show:!0}),e.create_user_direct=m()},e.show_edit_user_password=function(t){t?(e.edit_user_direct.user_password_is_visible=!0,e.edit_user_direct.password_input_type="text"):(e.edit_user_direct.user_password_is_visible=!1,e.edit_user_direct.password_input_type="password")},e.show_user_password=function(t){t?(e.create_user_direct.user_password_is_visible=!0,e.create_user_direct.password_input_type="text"):(e.create_user_direct.user_password_is_visible=!1,e.create_user_direct.password_input_type="password")},e.edit_service_user_form_submit=function(){var t={app_uuid:i.get_team().uuid,user_uuid:e.edit_user_direct.user_uuid,user_email:e.edit_user_direct.email,user_fullname:e.edit_user_direct.name};e.edit_user_direct.password&&e.edit_user_direct.password.length>0&&(t.user_password=sha1(e.edit_user_direct.password)),o.update_user(t).success(function(e){0==e.error_code?d(0,"application.people.EDIT_APP_USER_SUCCESS_TAG"):d(1,"application.people.EDIT_APP_USER_FAILED_TAG")}).error(function(e){d(1,"application.people.EDIT_APP_USER_FAILED_TAG")}),jQuery("#batch_edit_user").modal("hide"),e.page_app_user()},e.create_service_user_form_submit=function(){var t=(i.get_uuid(),{user_status:"SERVICE",is_service_user:!0,app_uuid:i.get_team().uuid,user_email:e.create_user_direct.email,user_fullname:e.create_user_direct.name,user_password:sha1(e.create_user_direct.password)});p.createServiceUser(t,function(t){var n="application.people.CREATE_APP_USER_SUCCESSFULLY_TAG",r=0;switch(t.error_code){case o.API_ERR.NO_ERR:break;case o.API_ERR.EX_USER:n="application.people.ALREADY_IS_APP_USER_TAG",r=1;break;case p.UP_TO_MAX_SERVICE_USERS_ERROR_CODE:n="application.people.QUOTA_REACH_TO_UPPER_LIMIT_TAG",r=1;break;default:n="application.people.CREATE_APP_USER_FAILED_TAG",r=1}jQuery("#batch_create_user").modal("hide"),e.page_app_user(),d(r,n)},function(t){jQuery("#batch_create_user").modal("hide"),e.page_app_user(),d(2,"application.people.CREATE_APP_USER_FAILED_TAG")})},e.should_show_edit_button=function(){var t=[];return angular.forEach(e.group,function(e){e.selected&&this.push(e)},t),1==t.length},e.should_show_remove_button=function(){var t=[];return angular.forEach(e.group,function(e){e.selected&&this.push(e)},t),t.length>0},e.show_remove_modal=function(){e.to_be_removed_users=[],angular.forEach(e.group,function(e){e.selected&&this.push(e)},e.to_be_removed_users),e.to_be_removed_users.length&&jQuery("#remove_user").modal({show:!0})},e.check_all_changed=function(t){angular.forEach(e.group,function(e){1==!e.is_owner_user&&(e.selected=t)})},e.$watch(function(e){var t=!0;return angular.forEach(e.group,function(e){e.selected&&(t=!1)}),t},function(e,t,n){var r=!0;angular.forEach(n.group,function(e){e.selected&&(r=!1)}),r&&(n.selected_all.selected=!1)}),e.remove_users=function(t){if(null!=t&&0!=t.length){var n=[];angular.forEach(t,function(e){this.push(e.uuid)},n);var r=o.leave_app(n,i.get_team().uuid);r.success(function(t){return 0!=t.error_code?(jQuery("#remove_user").modal("hide"),e.selected_all.selected=!1,e.page_app_user(),d(1,"application.people.REMOVE_APP_USER_FAILED_TAG"),void console.error(t)):(jQuery("#remove_user").modal("hide"),e.selected_all.selected=!1,e.page_app_user(),d(0,"application.people.REMOVE_APP_USER_SUCCESSFULLY_TAG"),void 0)}),r.error(function(t){jQuery("#remove_user").modal("hide"),e.selected_all.selected=!1,e.page_app_user(),d(2,"application.people.REMOVE_APP_USER_FAILED_TAG"),console.error(t)})}},e.page_app_user=function(t){var n=e.search_value||"",r=e.page_number=t||1;e.items_per_page=12,p.getAppServiceUsersWithPagination({sort:!0,filter_keyword:$.trim(n),start_page:r-1,length:e.items_per_page},function(t){e.group=t.users,e.total_items=t.total},function(t){e.group=[],e.total_items=0})};var A=function(){var t=i.get_team();return null==t?void console.error("no team info"):void e.page_app_user()},f=function(){g.prepare(function(e){A()},{$scope:e,onRefresh:A})},T=function(){var t=[];for(var n in u.en.application.people){var r="application.people."+n;t.push(r)}e.translate=function(){},_.translate(e,"lang",t,e.translate)},v=function(){e.refresh_settings_menu(),T(),f()};v(),l.attach("yvAppPeopleController",{$scope:e})}]),angular.module("this_app").controller("ApplicationWelcomeCtrl",["$scope","$state","$stateParams","$timeout","yvAjax","yvUser","yvTransTags","yvUtil","yvDebug","yvLogin",function(e,t,n,r,s,a,o,_,i,u){e.current_bubble={ppcom_launcher_color:"#54c6d6",ppcom_launcher_color_changed:!1};var c=function(t,n){s.update_app_info(t).success(function(t){console.log(t),0==t.error_code?(e.action_toast(e,0,"application.welcome.UPDATE_APP_SUCCESSFULLY_TAG"),n&&n()):t.error_code==-1?e.action_toast(e,1,"application.welcome.UPDATE_APP_LACK_PARAMS_TAG"):1==t.error_code?e.action_toast(e,1,"application.welcome.UPDATE_APP_NOT_EXIST_TAG"):e.action_toast(e,1,"application.welcome.UPDATE_ENCOUNTER_AN_ERROR_TAG")}).error(function(t){console.log(t),e.action_toast(e,2,"application.welcome.UPDATE_ENCOUNTER_AN_ERROR_TAG")})},l=function(){var t=a.get_team();return null==t?void console.error("no team info"):void r(function(){e.current_bubble={welcome_message:t.welcome_message,ppcom_launcher_color:t.ppcom_launcher_color?t.ppcom_launcher_color:"#54c6d6",ppcom_launcher_style:t.ppcom_launcher_style?t.ppcom_launcher_style:"DEFAULT",app_route_policy:t.app_route_policy,show_ppcom_hover:t.show_ppcom_hover,ppcom_powered_by_name:t.ppcom_powered_by_name,ppcom_powered_by_link:t.ppcom_powered_by_link,ppcom_powered_by_visible:t.ppcom_powered_by_visible},m()})},p=function(t,n){for(var r in t)if(r.length>512)return void e.action_toast(e,1,"application.welcome.WELCOME_WORDS_OUT_OF_LENGTH_TAG");n&&n(t)},g=function(){e.current_bubble.ppcom_launcher_color_changed=!1},m=function(){e.$watch("current_bubble.ppcom_launcher_color",function(t,n){if(n!==t)return void(e.current_bubble.ppcom_launcher_color_changed=!0)})};e.change_ppcom_color=function(){if(e.current_bubble.ppcom_launcher_color_changed){var t={app_uuid:a.get_team().uuid,ppcom_launcher_color:e.current_bubble.ppcom_launcher_color};c(t,g)}},e.update_team_info=function(t){if(!t)return void e.action_toast(e,1,"application.welcome.NO_CHANGED_TAG");var n={app_uuid:a.get_team().uuid,welcome_message:e.current_bubble.welcome_message};p(n,c)},e.get_launcher_style=function(){var t=null;e.current_bubble&&e.current_bubble.ppcom_launcher_color&&(t=e.current_bubble.ppcom_launcher_color),null==t&&(t="#54c6d6");var n={"background-color":t};return n},e.get_launcher_color_name=function(){var t=null;return e.current_bubble&&e.current_bubble.ppcom_launcher_color&&(t=e.current_bubble.ppcom_launcher_color),null==t&&(t="#54c6d6"),t};var E=function(){u.prepare(function(e){l()},{$scope:e,onRefresh:l})},d=function(){var t=[];for(var n in o.en.application.welcome){var r="application.welcome."+n;t.push(r)}e.translate=function(){},_.translate(e,"lang",t,e.translate)},A=function(){e.refresh_settings_menu(),d(),E()};A(),i.attach("yvAppWelcomeController",{$scope:e,yvUser:a})}]),angular.module("this_app").controller("GroupCtrl",["$scope","$cookies","$stateParams","$state","$timeout","yvAjax","yvUser","yvLogin","yvPagination",function(e,t,n,r,s,a,o,_,i){function u(){return{group_name:"",group_desc:""}}e.groups={groups:[],total_items:0,items_per_page:12,search_value:"",page_number:1,selected_all:{selected:!1},group:{items_per_page:12,total_items:0,page_number:1,search_value:"",group:null,users:null},remove:null,edit:null,create:{name:"",desc:""}},e.create_service_group_form_submit=function(){a.create_org_group({app_uuid:o.get_team().uuid,group_name:e.groups.create.group_name,group_desc:e.groups.create.group_desc}).success(function(t){0==t.error_code?e.toast_success_string("CREATE_SUCCESSFULLY_TAG"):e.toast_error_string("CREATE_FAILED_TAG")}).error(function(t){e.toast_error_string("CREATE_FAILED_TAG")}),e.page_service_group(),jQuery("#create_service_group").modal("hide")},e.edit_service_group_form_submit=function(){a.update_org_group({app_uuid:o.get_team.uud,group_uuid:e.groups.edit.uuid,group_name:e.groups.edit.group_name,group_desc:e.groups.edit.group_desc}).success(function(t){0==t.error_code?e.toast_success_string("UPDATE_SUCCESSFULLY_TAG"):e.toast_error_string("UPDATE_FAILED_TAG")}).error(function(t){e.toast_error_string("UPDATE_FAILED_TAG")}),e.page_service_group(),jQuery("#edit_service_group").modal("hide")},e.delete_groups=function(){var t=[];angular.forEach(e.groups.remove,function(e,t){this.push(e.uuid)},t),a.remove_org_group({app_uuid:o.get_team().uuid,group_uuid:t}).success(function(t){0==t.error_code?e.toast_success_string("DELETE_SUCCESSFULLY_TAG"):e.toast_error_string("DELETE_FAILED_TAG")}).error(function(t){e.toast_error_string("DELETE_FAILED_TAG")})},e.show_members_modal=function(t){e.groups.group.group=angular.copy(t),a.get_org_group_user_list({app_uuid:o.get_team().uuid,group_uuid:t.uuid}).success(function(t){0!=t.error_code?console.log("can not get org group user list"):s(function(){e.groups.group.users=t.list})}).error(function(e){console.log("can not get org group user list")}),jQuery("#group_members_modal").modal({show:!0})},e.show_edit_modal=function(){jQuery("#edit_service_group").modal({show:!0})},e.show_create_modal=function(){jQuery("#create_service_group").modal({show:!0}),e.groups.create=u()},e.should_show_remove_button=function(){var t=[];return angular.forEach(e.groups.groups,function(e){e.selected&&this.push(e)},t),t.length>0&&(e.groups.remove=angular.copy(t),!0)},e.should_show_edit_button=function(){var t=[];return angular.forEach(e.groups.groups,function(e){e.selected&&this.push(e)},t),1==t.length&&(e.groups.edit=angular.copy(t[0]),!0)},e.show_remove_modal=function(){null!=e.groups.remove&&0!=e.groups.remove.length&&jQuery("#delete_service_group").modal({show:!0})},e.check_all_changed=function(t){angular.forEach(e.groups.groups,function(e){e.selected=t})},e.page_service_group=function(t){var n=e.groups.search_value||"",r=e.groups.page_number=t||1;a.get_app_org_group_list({app_uuid:o.get_team().uuid}).success(function(t){if(0==t.error_code){var a=i.pagination({members:t.list,filter_keys:["group_name","group_desc"],filter_value:$.trim(n),page_offset:r-1,page_size:e.groups.items_per_page});s(function(){e.groups.groups=a.page,e.groups.total_items=a.total})}else e.groups.groups=[],e.groups.total_items=0}).error(function(){e.groups.groups=[],e.groups.total_items=0})};var c=function(){var t=o.get_team();return null==t?void console.error("no team info"):void e.page_service_group()},l=function(){_.prepare(function(e){c()},{$scope:e,onRefresh:c})},p=function(){e.refresh_settings_menu(),l()};p()}]),$yvGroupMembersCtrl.$inject=["$scope","$stateParams","$timeout","yvAjax","yvUser","yvLogin","yvPagination"],angular.module("this_app").controller("GroupMembersCtrl",$yvGroupMembersCtrl),angular.module("this_app").controller("SettingsPushCtrl",["$scope","$cookies","$state","$timeout","$translate","yvAjax","yvUtil","yvUser","yvTransTags","yvConstants","yvLogin","yvDebug",function(e,t,n,r,s,a,o,_,i,u,c,l){e.push={enable_apns_push:!1,enable_gcm_push:!1,enable_mqtt_push:!1,enable_jpush:!1,apns_combination_pem_file:null,apns_combination_pem_data:null,apns_combination_pem_password:null,gcm_api_key:null,jpush_api_key:null,jpush_master_secret:null},e.submit_push=function(){var t=angular.copy(e.push);delete t.apns_combination_pem_file,t.app_uuid=_.get_team().uuid,a.update_app_info(t).success(function(){e.toast_success_string("UPDATE_PUSH_CONFIG_SUCCESS_TAG")}).error(function(){e.toast_error_string("UPDATE_PUSH_CONFIG_FAILED_TAG")})},e.read_pem=function(t){var n=new FileReader;n.onload=function(t){return function(t){e.push.apns_combination_pem_data=t.target.result}}(t),n.readAsDataURL(t)};var p=function(){c.prepare(function(t){switch(t){case c.ERROR_CODE.OK:e.push.enable_apns_push=_.get_team().enable_apns_push||!1,e.push.enable_gcm_push=_.get_team().enable_gcm_push||!1,e.push.enable_mqtt_push=_.get_team().enable_mqtt_push||!1,e.push.enable_jpush=_.get_team().enable_jpush||!1,e.push.apns_combination_pem_data=_.get_team().apns_combination_pem_data,e.push.apns_combination_pem_password=_.get_team().apns_combination_pem_password,e.push.gcm_api_key=_.get_team().gcm_api_key,e.push.jpush_api_key=_.get_team().jpush_api_key,e.push.jpush_master_secret=_.get_team().jpush_master_secret;break;case c.ERROR_CODE.STATUS_ILLEGAL:}})},g=function(){var t=[];for(var n in i.en.settings.push){var r="settings.push."+n;t.push(r)}e.translate=function(){},o.translate(e,"lang",t,e.translate)},m=function(){e.refresh_settings_menu(),g(),p()};m()}]),angular.module("this_app").controller("StatisticsOverviewCtrl",["$scope","$state","$timeout","$translate","$stateParams","yvUser","yvAjax","yvUtil","yvTransTags","yvConstants","yvLogin",function(e,t,n,r,s,a,o,_,i,u,c){e.card_number={};var l=null,p=null,g="customer",m=function(){var t=o.ppconsole_get_overview_number(a.get_team().uuid);t.success(function(t){if(0==t.error_code)for(var n in t.number)t.number.hasOwnProperty(n)&&(e.card_number[n]=t.number[n])})},E=function(e){null!=l&&(l.destroy(),l=null);var t={labels:[],datasets:[{fillColor:"rgba(151,187,205,0.2)",strokeColor:"rgba(151,187,205,1)",pointColor:"rgba(151,187,205,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(151,187,205,1)",data:[]}]},n=document.getElementById("realtime-statistics"),r=n.getContext("2d");for(var s in e)t.labels.push(s+""),t.datasets[0].data.push(e[s+""][s+""]);l=new Chart(r).Line(t,{tooltipTemplate:"<%= value %>",responsive:!0,animationStep:40})},d=function(e,t,n){var r={labels:[],datasets:[{fillColor:"rgba(151,187,205,0.2)",strokeColor:"rgba(151,187,205,1)",pointColor:"rgba(151,187,205,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(151,187,205,1)",data:[]}]},s=moment.range(e,t);s.by("days",function(e){r.labels.push(e.format("MM-DD")),r.datasets[0].data.push(n[e.format("YYYY-MM-DD")])}),p&&(p.destroy(),p=null);var a=document.getElementById("history-statistics"),o=a.getContext("2d");p=new Chart(o).Line(r,{tooltipTemplate:"<%= value %>",responsive:!0,animationStep:40})},A=function(e){var t=angular.element(e.target).parent().parent().children();angular.forEach(t,function(e){angular.element(e).hasClass("active")&&angular.element(e).removeClass("active")}),angular.element(e.target).parent().hasClass("active")||angular.element(e.target).parent().addClass("active")},f=function(e){var t=o["ppconsole_get_real_time_"+e+"_number"],n=t(a.get_team().uuid);n.success(function(e){0==e.error_code&&E(e.number)}),n.error(function(e){console.error(e)})},T=function(e,t,n){var r=o["ppconsole_get_"+n+"_number_by_range"],s=r(a.get_team().uuid,e.format("YYYY-MM-DD"),t.format("YYYY-MM-DD"));s.success(function(n){0==n.error_code&&d(e,t,n.number)}),s.error(function(e){console.error(e)})};e.draw_realtime_message_number=function(e){A(e),f("message")},e.draw_realtime_customer_number=function(e){A(e),f("customer")},e.draw_realtime_service_number=function(e){A(e),f("service")},e.draw_history_message_number=function(e){A(e),g="message";var t=moment().subtract("days",30),n=moment();T(t,n,g)},e.draw_history_customer_number=function(e){
A(e),g="customer";var t=moment().subtract("days",30),n=moment();T(t,n,g)},e.draw_history_service_number=function(e){A(e),g="service";var t=moment().subtract("days",30),n=moment();T(t,n,g)},e.selecteddate=function(e,t){T(e,t,g)};var v=function(){var e=moment().subtract("days",30),t=moment();T(e,t,"customer"),m(),f("customer")},S=function(){var t=[];for(var n in i.en.statistics.overview){var r="statistics.overview."+n;t.push(r)}e.translate=function(){},_.translate(e,"lang",t,e.translate)},h=function(){S(),e.refresh_settings_menu(),c.prepare(function(e){v()},{$scope:e,onRefresh:v})};h()}]),angular.module("this_app").controller("StatisticsHistoryMessageCtrl",["$scope","$state","$timeout","$translate","$stateParams","yvAjax","yvUser","yvConstants","yvLog","yvUtil","yvTransTags","yvLogin",function(e,t,n,r,s,a,o,_,i,u,c,l){var p=10,g=5,m=p,E=[],d=function(){l.prepare(function(e){T(v,G)},{$scope:e,onRefresh:function(){T(v,G)}})},A=function(){var t=[];for(var n in c.en.statistics.historymessages){var r="statistics.historymessages."+n;t.push(r)}e.translate=function(){},u.translate(e,"lang",t,e.translate)},f=function(e){var t=function(e){return e.update_ts};e&&e.sort(function(e,n){var r=t(e),s=t(n);return r>=s?-1:1})},T=function(t,n){a.get_app_conversation_list({app_uuid:o.get_team().uuid}).success(function(n){var r=[];n.list&&$.each(n.list,function(t,n){var s=!1;if(!s){var a={user_uuid:n.create_user&&n.create_user.uuid,user_name:n.create_user&&n.create_user.user_fullname,user_image:n.create_user&&u.iconUtil.getIcon(n.create_user.user_icon),news_abbr:u.messageUtil.getMessageSummary(e.lang,n.latest_message&&n.latest_message.message_subtype,n.latest_message&&n.latest_message.body),news_count:n.message_total_count,news_date:u.messageUtil.getMessageFormatedDate(n.latest_message),con_uuid:n.uuid,update_ts:u.messageUtil.getConversationUpdateTsInSeconds(n)};r.push(a)}}),f(r),t&&t(r)}).error(function(e){n&&n(e)})},v=function(t){E=t;var n=E.length;y(n),n>0&&e.toggle_page(e.pages[0])},S=function(t,n){var r=t.data,s=r.list;e.messages=[],s.forEach(function(t){e.messages.unshift(U(t,n))})},h=function(t){e.set_flash_style("flash flash-error"),e.set_update_string(t)},G=function(t){h(e.lang["statistics.historymessages.MESSAGE_GET_ERROR_TAG"])},R=function(t){h(e.lang["statistics.historymessages.MESSAGE_GET_ERROR_TAG"])},y=function(t){var n=parseInt(t/m),r=n*m!=t?n+1:n;if(e.total_pages=r,e.total_pages>1)if(e.total_pages>g)for(var s=1;s<=g;s++){var a={};a.page_num=s,a.is_active=!1,e.pages.push(a)}else for(var s=1;s<=e.total_pages;s++){var a={};a.page_num=s,a.is_active=!1,e.pages.push(a)}else e.pages.push({page_num:1,is_active:!1})},C=function(e,t){return e==t?"DIR_IN":"DIR_OUT"},O=function(t){var r=[];E.forEach(function(e){var n=e.news_date;n.split()[0]==t&&r.push(e)}),n(function(){e.news_list=r})},P=function(e){return[]},U=function(e,t){var n=null;n="AP"==e.from_type?u.iconUtil.getIcon():u.iconUtil.getIcon(e.from_user.user_icon);var r=JSON.parse(e.message_body),s={conversation_uuid:r.ci,from_uuid:r.fi,message_direction:C(e.from_uuid,t),message_duration:null,message_file:null,message_id:r.id,message_mime:null,message_name:null,message_size:null,message_body:e.body,message_status:"RECV_NEW",message_subtype:r.ms,message_thumbnail:null,message_timestamp:r.ts,show_profile:!1,show_timestamp:!0,task_uuid:null,to_uuid:r.ti,to_type:r.tt,message_type:"NOTI",conversation_type:e.conversation_type,from_user:e.from_user,user_icon:n};return s};e.messages=[],e.news_list=[],e.cur_page=-1,e.pages=[],e.search_conversations=function(){if(""!=e.search_target){var t=P(e.search_target);return e.search_target="",0==t.length?void alert("No Results"):void n(function(){e.news_list=t})}},e.select_date=function(e,t){var n=e.format("YYYY-MM-DD");O(n)},e.show_pre_window=function(t){e.messages=[];var n=t.con_uuid,r=t.user_uuid;a.get_history_messages({conversation_uuid:n,page_offset:-1}).then(function(e){S(e,r)},R)},e.toggle_page=function(t){if(t.page_num!=e.cur_page){var n=E.slice((t.page_num-1)*m,t.page_num*m);e.news_list=n,e.pages.forEach(function(e){e.is_active=!1}),t.is_active=!0,e.cur_page=t.page_num}},e.pre_pages=function(){var t=e.pages[0].page_num;if(1!=t){var n=0;n=t>=g?g:t-1;for(var r=1;r<=n;r++){var s={};s.page_num=t-r,s.is_active=!1,e.pages.unshift(s)}e.pages=e.pages.slice(0,g),e.toggle_page(e.pages[e.pages.length-1])}},e.back_pages=function(){var t=e.pages[e.pages.length-1].page_num;if(t!=e.total_pages){var n=0,r=e.total_pages-t;n=r>=g?g:r,e.pages=[];for(var s=1;s<=n;s++){var a={};a.page_num=t+s,a.is_active=!1,e.pages.push(a)}e.toggle_page(e.pages[0])}};var I=function(){e.refresh_settings_menu(),A(),d()};I()}]),angular.module("this_app").directive("dateRange",["$translate","$rootScope",function(e,t){return{restrict:"A",scope:{onApply:"&",hasPredefinedRanges:"=",isSingle:"="},link:function(n,r,s){var a=function(){var t=["calendar.TODAY_TAG","calendar.YESTERDAY_TAG","calendar.LAST_7_DAYS_TAG","calendar.LAST_30_DAYS_TAG","calendar.THIS_MONTH_TAG","calendar.LAST_MONTH_TAG","calendar.APPLY_LABEL_TAG","calendar.CANCEL_LABEL_TAG","calendar.FROM_LABEL_TAG","calendar.TO_LABEL_TAG","calendar.CUSTOM_RANGE_LABEL_TAG","calendar.monthname.JANUARY_TAG","calendar.monthname.FEBRUARY_TAG","calendar.monthname.MARCH_TAG","calendar.monthname.APRIL_TAG","calendar.monthname.MAY_TAG","calendar.monthname.JUNE_TAG","calendar.monthname.JULY_TAG","calendar.monthname.AUGUST_TAG","calendar.monthname.SEPTEMBER_TAG","calendar.monthname.OCTOBER_TAG","calendar.monthname.NOVEMBER_TAG","calendar.monthname.DECEMBER_TAG"];e(t).then(function(t){var s=e.use(),a=t,o=null;1==n.hasPredefinedRanges&&(o={},o[a["calendar.TODAY_TAG"]]=[moment(),moment()],o[a["calendar.YESTERDAY_TAG"]]=[moment().subtract("days",1),moment().subtract("days",1)],o[a["calendar.LAST_7_DAYS_TAG"]]=[moment().subtract("days",6),moment()],o[a["calendar.LAST_30_DAYS_TAG"]]=[moment().subtract("days",29),moment()],o[a["calendar.THIS_MONTH_TAG"]]=[moment().startOf("month"),moment().endOf("month")],o[a["calendar.LAST_MONTH_TAG"]]=[moment().subtract("month",1).startOf("month"),moment().subtract("month",1).endOf("month")]);var _={};_.applyLabel=a["calendar.APPLY_LABEL_TAG"],_.cancelLabel=a["calendar.CANCEL_LABEL_TAG"],_.fromLabel=a["calendar.FROM_LABEL_TAG"],_.toLabel=a["calendar.TO_LABEL_TAG"],_.customRangeLabel=a["calendar.CUSTOM_RANGE_LABEL_TAG"],_.daysOfWeek=["Su","Mo","Tu","We","Th","Fr","Sa"];var i=[];i[0]=a["calendar.monthname.JANUARY_TAG"],i[1]=a["calendar.monthname.FEBRUARY_TAG"],i[2]=a["calendar.monthname.MARCH_TAG"],i[3]=a["calendar.monthname.APRIL_TAG"],i[4]=a["calendar.monthname.MAY_TAG"],i[5]=a["calendar.monthname.JUNE_TAG"],i[6]=a["calendar.monthname.JULY_TAG"],i[7]=a["calendar.monthname.AUGUST_TAG"],i[8]=a["calendar.monthname.SEPTEMBER_TAG"],i[9]=a["calendar.monthname.OCTOBER_TAG"],i[10]=a["calendar.monthname.NOVEMBER_TAG"],i[11]=a["calendar.monthname.DECEMBER_TAG"],_.monthNames=i,_.firstDay=1,r.daterangepicker({linkedCalendars:!0,opens:"left",minDays:2,maxDays:30,singleDatePicker:n.isSingle,startDate:n.isSingle?moment():moment().subtract("days",30),endDate:moment(),format:"YYYY/MM/DD",dateLimit:{days:30}},function(e,t){e.locale(s),t.locale(s),n.onApply()(e,t)})})};t.$on("$translateChangeSuccess",a),a()}}}]),function(){function e(){return{restrict:"A",link:function(e,t,n){t.attr("target","_blank")}}}angular.module("this_app").directive("yvHrefBlank",e)}(),angular.module("this_app").directive("yvcolorpicker",["$timeout",function(e){return{restrict:"A",require:"ngModel",link:function(e,t,n,r){t.ColorPickerSliders({placement:"right",color:r.$modelValue,previewformat:"hex",swatches:!0,sliders:!0,hsvpanel:!0,onchange:function(t,n){e.$apply(function(){r.$setViewValue(n.tiny.toHexString())})}}),r.$render=function(){t.val(r.$modelValue),t.change()}}}}]),angular.module("this_app").directive("yvMessage",["$rootScope","$timeout","yvConstants","yvType","yvUtil",function(e,t,n,r,s){function a(t,a,o){function _(){t.message.show_profile=!1}t.isFileMessage=function(e){return r.is_file(e)},t.isVideoMessage=function(e){return r.is_video(e)},t.isGPSLocationMessage=function(e){return r.is_gps_location(e)},t.isTextMessage=function(e){return r.is_text(e)},t.isTxtMessage=function(e){return r.is_txt(e)},t.isImageMessage=function(e){return r.is_image(e)},t.isAudioMessage=function(e){return r.is_audio(e)},t.isCardMessage=function(e){return r.is_single_card(e)||r.is_multiple_card(e)},t.viewImage=function(e){},t.viewLocation=function(e){},t.viewCard=function(e){},t.showAlertIcon=function(e){return!(!r.is_right(e)||e.message_status!==n.SEND_STATUS.SEND_ERROR)},t.showMouth=function(e){return!r.is_image(e)&&!r.is_gps_location(e)},t.viewProfile=function(e){t.message.show_profile=!0},t.getUserIcon=function(e){return e.user_icon},t.getMessageClass=function(e){var t="";return r.is_left(e)?t+=" yv-left ":r.is_right(e)&&(t+=" yv-right "),t+=" yv-pc "},t.shouldShowTimestamp=function(e){var n=t.lastMessage;if(!n)return!0;var r=n.message_timestamp,s=e.message_timestamp,a=s-r;return a>60},t.getTimestamp=function(e){var t=1e3*e.message_timestamp;return s.formateTimestamp(t)},t.getFontStyle=function(){return{}},t.$on("$destroy",function(){e.$broadcast("event:stop-play-audio")}),_()}return{restrict:"E",scope:{message:"=",isLast:"=",lastMessage:"="},link:a,templateUrl:"templates/directive/message.html"}}]),angular.module("this_app").directive("yvTextMessage",[function(){function e(e,t,n){t.html(e.message.message_body)}return{restrict:"E",replace:!0,scope:{message:"="},link:e,template:"<pre class='yv-chat-text'></pre>"}}]),angular.module("this_app").directive("yvTxtMessage",["yvUtil","yvLog",function(e,t){function n(t,n,r){function s(t){var r=e.fileUtil.getFileDownloadUrl(JSON.parse(t.message_body).fid);e.fileUtil.getRemoteTextFileContent(r,function(e){n.text(e)},function(e){n.text(e)})}s(t.message)}return{restrict:"E",replace:!0,scope:{message:"="},link:n,template:"<pre class='yv-chat-text'></pre>"}}]),angular.module("this_app").directive("yvImageMessage",["yvUtil","yvLog",function(e,t){function n(t,n,r){function s(t){var r=t.message_body,s=e.iconUtil.getIcon(JSON.parse(r).orig);n.find("img").attr("src",s)}s(t.message)}return{restrict:"E",replace:!0,scope:{message:"="},link:n,template:'<div class="yv-chat-image"><img></div>'}}]),angular.module("this_app").directive("yvFileMessage",["$translate","yvUtil","yvLog",function(e,t,n){function r(n,r,s){var a=JSON.parse(n.message.message_body),o=r.find(".yv-chat-file");e(["statistics.historymessages.MESSAGE_FILE_TYPE_TAG","statistics.historymessages.MESSAGE_IMAGE_TYPE_TAG","statistics.historymessages.MESSAGE_TXT_TYPE_TAG"]).then(function(e){o.text(t.messageUtil.getMessageSummary(e,"FILE",n.message.message_body)).attr("href",t.fileUtil.getFileDownloadUrl(a.fid,a.name))})}return{restrict:"E",replace:!0,scope:{message:"=",lang:"="},link:r,template:"<div class='yv-chat-div'><a class='yv-chat-file'></a></div>"}}]),angular.element(document).ready(function(){angular.bootstrap(document,["this_app"])});